import{a as M,b as D,c as U,d as j,e as F,f as l,g as P,h as J,i as O,j as W,k as z}from"./chunk-VRU7KK3B.js";import{k as B,l as $}from"./chunk-SDTS7ZUR.js";import{B as y,Ba as g,Da as V,Fa as _,Ga as N,H as I,Ha as w,Ia as A,Ja as i,Ka as e,La as a,M as S,Ma as f,Na as p,Oa as m,Pa as n,Qa as h,R as T,Ra as k,Sa as G,V as E,ba as v,ca as c,qa as d,ra as C}from"./chunk-U35MBERR.js";var x=(()=>{class s{constructor(t){this.http=t,this.apiUrl="http://172.16.103.84:85/api/Visits"}headers(){let t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9jbGFpbXMvcm9sZSI6IkFkbWluIiwidWlkIjoiMyIsImV4cCI6MjA3MTU2OTA0NCwiaXNzIjoiUGF0aWVudFZpc2l0TWFuYWdlciIsImF1ZCI6IlBhdGllbnRWaXNpdE1hbmFnZXJVc2VycyJ9.JkH2gveIw04UjBQe8QXDlyudYLNgE4hp6dKOHg2bpdU";return new B({Authorization:`Bearer ${t}`})}getAllVisits(){return this.http.get(this.apiUrl,{headers:this.headers()})}getVisitById(t){return this.http.get(`${this.apiUrl}/${t}`,{headers:this.headers()})}addVisit(t){return this.http.post(this.apiUrl,t,{headers:this.headers()})}updateVisit(t,r){return this.http.put(`${this.apiUrl}/${t}`,r,{headers:this.headers()})}deleteVisit(t){return this.http.delete(`${this.apiUrl}/${t}`,{headers:this.headers()})}static{this.\u0275fac=function(r){return new(r||s)(T($))}}static{this.\u0275prov=S({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();function Z(s,u){if(s&1){let t=f();i(0,"form",4),p("ngSubmit",function(){v(t);let o=m();return c(o.onSubmit())}),i(1,"div")(2,"label",5),n(3,"Visit ID"),e(),a(4,"br")(5,"input",6),e(),i(6,"div")(7,"label",7),n(8,"Visit Type"),e(),a(9,"br")(10,"input",8),e(),i(11,"div")(12,"label",9),n(13,"Visit Type ID"),e(),a(14,"br")(15,"input",10),e(),i(16,"div")(17,"label",11),n(18,"Visit Duration (min)"),e(),a(19,"br")(20,"input",12),e(),i(21,"div")(22,"label",13),n(23,"Visit Date/Time"),e(),a(24,"br")(25,"input",14),e(),i(26,"div")(27,"label",15),n(28,"Visit Fee"),e(),a(29,"br")(30,"input",16),e(),i(31,"div")(32,"button",17),n(33,"Add Visit"),e(),i(34,"button",18),p("click",function(){v(t);let o=m();return c(o.deactivateForm())}),n(35,"cancel"),e()()()}if(s&2){let t=m();V("formGroup",t.addVisitForm),d(32),V("disabled",t.addVisitForm.invalid||t.addVisitForm.pending)}}function q(s,u){if(s&1){let t=f();i(0,"form",19),p("ngSubmit",function(){v(t);let o=m();return c(o.onEdit())}),i(1,"div")(2,"label",20),n(3,"Visit ID"),e(),a(4,"br")(5,"input",21),e(),i(6,"div")(7,"label",22),n(8,"Visit Type"),e(),a(9,"br")(10,"input",23),e(),i(11,"div")(12,"label",24),n(13,"Visit Type ID"),e(),a(14,"br")(15,"input",25),e(),i(16,"div")(17,"label",26),n(18,"Visit Duration (min)"),e(),a(19,"br")(20,"input",27),e(),i(21,"div")(22,"label",28),n(23,"Visit Date/Time"),e(),a(24,"br")(25,"input",29),e(),i(26,"div")(27,"label",30),n(28,"Visit Fee"),e(),a(29,"br")(30,"input",31),e(),i(31,"div")(32,"button",17),n(33,"Edit Visit"),e(),i(34,"button",18),p("click",function(){v(t);let o=m();return c(o.deactivateEditForm())}),n(35,"cancel"),e()()()}if(s&2){let t=m();V("formGroup",t.editVisitForm),d(32),V("disabled",t.editVisitForm.invalid||t.editVisitForm.pending)}}function R(s,u){if(s&1){let t=f();i(0,"tr")(1,"td"),n(2),e(),i(3,"td"),n(4),e(),i(5,"td"),n(6),e(),i(7,"td"),n(8),e(),i(9,"td"),n(10),e(),i(11,"td"),n(12),e(),i(13,"td",32)(14,"button",33),p("click",function(){let o=v(t).$implicit,b=m();return c(b.activateEditForm(o))}),n(15,"Edit"),e(),i(16,"button",34),p("click",function(){let o=v(t).$implicit,b=m();return c(b.deleteAction(o.visitID))}),n(17,"Delete"),e()()()}if(s&2){let t=u.$implicit,r=m();d(2),h(t.visitID),d(2),h(t.visitType),d(2),h(t.visitTypeID),d(2),h(t.visitDuration),d(2),h(r.displayDate(t.visitDate)),d(2),h(t.visitFee)}}var rt=(()=>{class s{constructor(t){this.visitService=t,this.AllVisits=[],this.AddBtnPressed=!1,this.EditBtnPressed=!1,this.editingId=null}ngOnInit(){this.addVisitForm=new F({visitID:new l(null,[D.required]),visitType:new l(""),visitTypeID:new l(1,[D.required]),visitDuration:new l(null),visitDate:new l(null),visitFee:new l(null)}),this.editVisitForm=new F({visitID:new l(null,[D.required]),visitType:new l(""),visitTypeID:new l(1,[D.required]),visitDuration:new l(null),visitDate:new l(null),visitFee:new l(null)}),this.reloadVisitsAndSetNextId()}activateForm(){this.AddBtnPressed=!0}deactivateForm(){this.AddBtnPressed=!1,this.resetAddFormToNextId()}activateEditForm(t){this.editingId=Number(t.visitID),this.EditBtnPressed=!0,this.editVisitForm.patchValue({visitID:t.visitID??null,visitType:t.visitType??"",visitTypeID:t.visitTypeID??1,visitDuration:t.visitDuration??null,visitDate:Y(t.visitDate),visitFee:t.visitFee??null})}deactivateEditForm(){this.EditBtnPressed=!1,this.editVisitForm.reset(),this.editingId=null}onSubmit(){let t=this.addVisitForm.getRawValue(),r={visitID:t.visitID??void 0,visitType:t.visitType??"",visitTypeID:Number(t.visitTypeID??1),visitDuration:Number(t.visitDuration??0),visitDate:H(t.visitDate),visitFee:Number(t.visitFee??0)};this.visitService.addVisit(r).pipe(I(()=>this.visitService.getAllVisits()),y(()=>this.AddBtnPressed=!1)).subscribe({next:o=>{this.AllVisits=o??[],this.resetAddFormToNextId()},error:o=>alert(o)})}onEdit(){if(this.editingId==null)return;let t=this.editVisitForm.getRawValue(),r={visitID:Number(t.visitID),visitType:t.visitType??"",visitTypeID:Number(t.visitTypeID??1),visitDuration:Number(t.visitDuration??0),visitDate:H(t.visitDate),visitFee:Number(t.visitFee??0)};this.visitService.updateVisit(this.editingId,r).pipe(I(()=>this.visitService.getAllVisits()),y(()=>this.deactivateEditForm())).subscribe({next:o=>this.AllVisits=o??[],error:o=>alert(o)})}deleteAction(t){t!=null&&this.visitService.deleteVisit(t).pipe(I(()=>this.visitService.getAllVisits())).subscribe({next:r=>this.AllVisits=r??[],error:r=>alert(r)})}reloadVisitsAndSetNextId(){this.visitService.getAllVisits().subscribe({next:t=>{this.AllVisits=t??[],this.resetAddFormToNextId()},error:t=>alert(t)})}computeNextId(){return this.AllVisits?.length?this.AllVisits.reduce((t,r)=>Math.max(t,Number(r.visitID)||0),0)+1:1}resetAddFormToNextId(){let t=this.computeNextId(),r=this.addVisitForm.get("visitID");r?.setValue(t),r?.setValidators([D.required,D.min(t)]),r?.updateValueAndValidity({emitEvent:!1}),this.addVisitForm.patchValue({visitType:"",visitTypeID:1,visitDuration:null,visitDate:null,visitFee:null}),this.addVisitForm.markAsPristine()}displayDate(t){if(!t)return"\u2014";try{return new Date(t).toLocaleString()}catch{return t}}static{this.\u0275fac=function(r){return new(r||s)(C(x))}}static{this.\u0275cmp=E({type:s,selectors:[["app-visit-dashboard"]],standalone:!0,features:[k([x]),G],decls:26,vars:2,consts:[[3,"click"],["id","addVisitForm",3,"formGroup"],["id","editVisitForm",3,"formGroup"],[1,"visits-table"],["id","addVisitForm",3,"ngSubmit","formGroup"],["for","visitID"],["formControlName","visitID","type","number","id","visitID","name","visitID"],["for","visitType"],["formControlName","visitType","type","text","id","visitType","name","visitType","placeholder","Emergency / Follow-Up / Consultation"],["for","visitTypeID"],["formControlName","visitTypeID","type","number","id","visitTypeID","name","visitTypeID"],["for","visitDuration"],["formControlName","visitDuration","type","number","id","visitDuration","name","visitDuration"],["for","visitDate"],["formControlName","visitDate","type","datetime-local","id","visitDate","name","visitDate"],["for","visitFee"],["formControlName","visitFee","type","number","id","visitFee","name","visitFee"],["type","submit",3,"disabled"],["type","button",3,"click"],["id","editVisitForm",3,"ngSubmit","formGroup"],["for","e_visitID"],["formControlName","visitID","type","number","id","e_visitID","name","visitID"],["for","e_visitType"],["formControlName","visitType","type","text","id","e_visitType","name","visitType"],["for","e_visitTypeID"],["formControlName","visitTypeID","type","number","id","e_visitTypeID","name","visitTypeID"],["for","e_visitDuration"],["formControlName","visitDuration","type","number","id","e_visitDuration","name","visitDuration"],["for","e_visitDate"],["formControlName","visitDate","type","datetime-local","id","e_visitDate","name","visitDate"],["for","e_visitFee"],["formControlName","visitFee","type","number","id","e_visitFee","name","visitFee"],[1,"actions"],["type","button",1,"btn","btn-edit",3,"click"],["type","button",1,"btn","btn-delete",3,"click"]],template:function(r,o){r&1&&(i(0,"h2"),n(1,"Visits"),e(),i(2,"button",0),p("click",function(){return o.activateForm()}),n(3,"+Add New Visit"),e(),g(4,Z,36,2,"form",1)(5,q,36,2,"form",2),i(6,"table",3)(7,"thead")(8,"tr")(9,"th"),n(10,"Visit ID"),e(),i(11,"th"),n(12,"Visit Type"),e(),i(13,"th"),n(14,"Visit Type ID"),e(),i(15,"th"),n(16,"Visit Duration"),e(),i(17,"th"),n(18,"Visit Date"),e(),i(19,"th"),n(20,"Visit Fee"),e(),i(21,"th"),n(22,"Actions"),e()()(),i(23,"tbody"),w(24,R,18,6,"tr",null,N),e()()),r&2&&(d(4),_(4,o.AddBtnPressed?4:-1),d(),_(5,o.EditBtnPressed?5:-1),d(19),A(o.AllVisits))},dependencies:[z,P,M,J,U,j,O,W]})}}return s})();function H(s){return s?new Date(s).toISOString():new Date().toISOString()}function Y(s){if(!s)return null;let u=new Date(s),t=r=>String(r).padStart(2,"0");return`${u.getFullYear()}-${t(u.getMonth()+1)}-${t(u.getDate())}T${t(u.getHours())}:${t(u.getMinutes())}`}export{rt as VisitDashboardComponent};
